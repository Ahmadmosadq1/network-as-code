name: frr-medium

mgmt:
  network: frr_mgmt
  ipv4-subnet: 172.20.100.0/24

topology:
  nodes:

    R1:
      kind: linux
      image: frrouting/frr:latest
      user: root
      mgmt-ipv4: 172.20.100.11
      exec:
        - sh -lc 'apk add --no-cache openssh shadow'
        - sh -lc 'adduser -D -s /bin/sh ahmed'
        - sh -lc 'echo "ahmed:1111" | chpasswd'
        - sh -lc 'ssh-keygen -A'
        - sh -lc 'mkdir -p /run/sshd'
        - sh -lc 'sed -i "s/^#\\?PasswordAuthentication.*/PasswordAuthentication yes/" /etc/ssh/sshd_config'
        - sh -lc '/usr/sbin/sshd'

    R2:
      kind: linux
      image: frrouting/frr:latest
      user: root
      mgmt-ipv4: 172.20.100.12
      exec:
        - sh -lc 'apk add --no-cache openssh shadow'
        - sh -lc 'adduser -D -s /bin/sh ahmed'
        - sh -lc 'echo "ahmed:1111" | chpasswd'
        - sh -lc 'ssh-keygen -A'
        - sh -lc 'mkdir -p /run/sshd'
        - sh -lc 'sed -i "s/^#\\?PasswordAuthentication.*/PasswordAuthentication yes/" /etc/ssh/sshd_config'
        - sh -lc '/usr/sbin/sshd'

    R3:
      kind: linux
      image: frrouting/frr:latest
      user: root
      mgmt-ipv4: 172.20.100.13
      exec:
        - sh -lc 'apk add --no-cache openssh shadow'
        - sh -lc 'adduser -D -s /bin/sh ahmed'
        - sh -lc 'echo "ahmed:1111" | chpasswd'
        - sh -lc 'ssh-keygen -A'
        - sh -lc 'mkdir -p /run/sshd'
        - sh -lc 'sed -i "s/^#\\?PasswordAuthentication.*/PasswordAuthentication yes/" /etc/ssh/sshd_config'
        - sh -lc '/usr/sbin/sshd'

    R4:
      kind: linux
      image: frrouting/frr:latest
      user: root
      mgmt-ipv4: 172.20.100.14
      exec:
        - sh -lc 'apk add --no-cache openssh shadow'
        - sh -lc 'adduser -D -s /bin/sh ahmed'
        - sh -lc 'echo "ahmed:1111" | chpasswd'
        - sh -lc 'ssh-keygen -A'
        - sh -lc 'mkdir -p /run/sshd'
        - sh -lc 'sed -i "s/^#\\?PasswordAuthentication.*/PasswordAuthentication yes/" /etc/ssh/sshd_config'
        - sh -lc '/usr/sbin/sshd'

    h1:
      kind: linux
      image: alpine:latest
      user: root
      mgmt-ipv4: 172.20.100.21
      exec:
        - sh -lc 'apk add --no-cache iproute2 iputils'

    h2:
      kind: linux
      image: alpine:latest
      user: root
      mgmt-ipv4: 172.20.100.22
      exec:
        - sh -lc 'apk add --no-cache iproute2 iputils'

  links:
    - endpoints: ["R1:eth1", "R2:eth1"]
    - endpoints: ["R2:eth2", "R3:eth1"]
    - endpoints: ["R2:eth3", "R4:eth1"]
    - endpoints: ["R1:eth2", "h1:eth1"]
    - endpoints: ["R4:eth2", "h2:eth1"]
